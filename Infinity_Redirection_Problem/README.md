# 🌀 Spring Boot 무한 리다이렉션 문제 분석

**발표자**: 최정
**발표일**: 2025년 7월 4일  
**세미나 주제**: Docker 배포 시 발생한 Spring Boot 무한 리다이렉션 문제 분석 및 해결 방안 제시

---

## 📑 목차

1. [문제 제기](#1-문제-제기)  
2. [현상 분석](#2-현상-분석)  
3. [환경 비교](#3-환경-비교)  
4. [공식문서와 레퍼런스 조사 결과](#4-공식문서와-레퍼런스-조사-결과)  
5. [해결 방안](#5-해결-방안)  
6. [검사 프로그램 소개](#6-검사-프로그램-소개)  
7. [의의 및 확장 가능성](#7-의의-및-확장-가능성)  
8. [결론](#8-결론)  

---

## 1. 문제 제기

Spring Boot 프로젝트를 Docker 이미지로 빌드 후 실행하는 과정에서 **무한 리다이렉션 오류**가 발생함.  
이 프로젝트는 이전 학기 '오픈소스 SW 설계' 교과목에서 만든 웹 애플리케이션으로, 로컬(IntelliJ) 환경에서는 문제 없이 실행되었음.

> **핵심 질문**: _"왜 환경이 바뀌자 오류가 발생했는가?"_  
단순한 코드 수정이 아닌 **환경 차이에 따른 원인 분석**에 중점을 둠.

---

## 2. 현상 분석

| 실행 환경                  | 결과       |
|---------------------------|------------|
| IntelliJ (로컬) 실행       | ✅ 정상 작동 |
| EC2 + `bootRun` 실행       | ✅ 정상 작동 |
| Docker 이미지 실행         | ❌ 무한 리다이렉션 발생 |

---

## 3. 환경 비교

- Docker는 JAR 내부 리소스를 **classpath 기반으로 엄격하게 해석**함.
- `/`로 시작하는 뷰 이름은 URL로 오해되어 무한 리다이렉션이 유발될 수 있음.
- 리소스 탐색 범위가 제한되기 때문에 **슬래시 사용 방식**이 중요함.

---

## 4. 공식문서와 레퍼런스 조사 결과

- **Spring 공식문서**에서는 템플릿 경로(`spring.thymeleaf.prefix = classpath:/templates/`)에 대한 설명만 존재.
- `return "/view"` 형식에 대한 경고나 금지 내용은 없음.

### 커뮤니티 사례

- GitHub, StackOverflow에 `"Thymeleaf templates preceded by a slash"` 관련 이슈 다수
- `"Circular view path [index.html]"` 와 같은 오류 보고 존재
- **슬래시 포함 뷰 반환 문제는 자주 발생하지만 공식 가이드는 없음**

---

## 5. 해결 방안

### ✅ 코드 규칙 설정

- 뷰 반환 시 `return "viewName"` 형식을 사용 (슬래시 없이)
- 리다이렉션은 명시적으로 `return "redirect:/..."` 형식 사용
- 팀 코드 컨벤션 및 리뷰 기준에 명시

### ✅ 정적 검사 도구 적용

- 코드에서 `return "/..."` 형식을 정규식으로 탐지
- 빌드 또는 CI 단계에서 경고 또는 실패 처리

---

## 6. 검사 프로그램 소개

문제 발생 패턴을 사전에 탐지하기 위한 **정적 검사 프로그램**을 자바로 직접 구현함.  
해당 프로그램은 다음과 같은 역할을 수행함:

- Java 소스 코드 내에서 `return "/..."` 형태의 뷰 반환 구문을 탐색
- 주석은 제외하고 실제 코드만 분석
- 문제가 되는 구문이 존재할 경우 경고를 출력하고, 컴파일 실패 메시지를 제공
- 모든 뷰 반환이 안전할 경우에는 성공 메시지를 출력

이 도구는 로컬에서 실행하거나 CI에 연동하여 자동화된 검출을 수행할 수 있도록 설계되었음.

---

## 7. 의의 및 확장 가능성

### ✅ 의의

- Spring Boot 문서의 **사각지대를 발견**하고 문제를 구조적으로 분석
- 단순 수정이 아닌, **자동 검사 도구**로 확장

### 🚀 확장 가능성

- CI 파이프라인에 통합하여 PR 시 자동 검출 가능
- 정적 분석 도구의 룰로 자동화 가능
- IDE 플러그인으로 실시간 검사 기능 구현 가능

---

## 8. 결론

- **문제 발생**: Docker 환경에서 `/`로 시작하는 뷰 반환으로 인해 무한 리다이렉션 발생
- **원인 분석**: ViewResolver가 뷰가 아닌 URL로 인식했기 때문
- **문서 한계**: 공식 문서에서는 해당 문제를 경고하지 않음
- **해결 방안**:
  - 슬래시 없는 뷰 이름 반환 권장
  - `redirect:/...` 형식으로 의도 명시
  - 정적 분석기를 통한 자동 검출 및 예방

> ✅ **작은 코드 문제를 구조적으로 분석하고 자동화 도구로 확장함으로써 실무에서도 응용 가능한 방식으로 발전시킬 수 있었음.**  
> ✅ **환경 차이를 이해하고 대응하는 개발자의 태도 역시 중요함.**

